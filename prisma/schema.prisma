generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model adminuser {
  id          String        @id
  name        String
  userId      String        @unique(map: "AdminUser_userId_key")
  user        user          @relation(fields: [userId], references: [id], onDelete: Cascade, map: "AdminUser_userId_fkey")
  chatmessage chatmessage[]
}

model application {
  id           String     @id
  status       String
  influencerId Int
  campaignId   String
  createdAt    DateTime   @default(now())
  campaign     campaign   @relation(fields: [campaignId], references: [id], map: "Application_campaignId_fkey")
  influencer   influencer @relation(fields: [influencerId], references: [id], map: "Application_influencerId_fkey")

  @@index([campaignId], map: "Application_campaignId_fkey")
  @@index([influencerId], map: "Application_influencerId_fkey")
}

model brand {
  id            String          @id
  name          String
  industry      String
  totalSpend    Float
  avatarInitial String?
  userId        String          @unique(map: "Brand_userId_key")
  user          user            @relation(fields: [userId], references: [id], onDelete: Cascade, map: "Brand_userId_fkey")
  campaign      campaign[]
  subscription  subscription?
  supportticket supportticket[]
}

model campaign {
  id           String          @id
  createdAt    DateTime        @default(now())
  brandId      String
  budgetRange  String
  deadline     DateTime
  deliverables String
  description  String
  niche        String
  platforms    String          @db.Text
  status       campaign_status
  title        String
  application  application[]
  brand        brand           @relation(fields: [brandId], references: [id], map: "Campaign_brandId_fkey")

  @@index([brandId], map: "Campaign_brandId_fkey")
}

model chatmessage {
  id            String        @id
  text          String        @db.Text
  createdAt     DateTime      @default(now())
  ticketId      String
  senderId      String
  adminuser     adminuser     @relation(fields: [senderId], references: [id], map: "ChatMessage_senderId_fkey")
  supportticket supportticket @relation(fields: [ticketId], references: [id], map: "ChatMessage_ticketId_fkey")

  @@index([senderId], map: "ChatMessage_senderId_fkey")
  @@index([ticketId], map: "ChatMessage_ticketId_fkey")
}

model influencer {
  id             Int             @id @default(autoincrement())
  platform       String
  username       String          @unique(map: "Influencer_username_key")
  followers      Int             @default(0)
  mediaCount     Int             @default(0)
  connected      Boolean         @default(false)
  engagementRate Float?
  userId         String          @unique(map: "Influencer_userId_key")
  application    application[]
  user           user            @relation(fields: [userId], references: [id], onDelete: Cascade, map: "Influencer_userId_fkey")
  subscription   subscription?
  supportticket  supportticket[]
}

model settings {
  id                  String  @id
  stripeApiKey        String?
  paypalBusinessEmail String?
  notifyOnPayment     Boolean @default(true)
  notifyOnSupport     Boolean @default(true)
  notifyOnCampaign    Boolean @default(true)
  notifyWeeklyReports Boolean @default(false)
}

model subscription {
  id           String      @id
  plan         String
  status       String
  amount       Float
  renewalDate  DateTime
  brandId      String?     @unique(map: "Subscription_brandId_key")
  influencerId Int?        @unique(map: "Subscription_influencerId_key")
  brand        brand?      @relation(fields: [brandId], references: [id], map: "Subscription_brandId_fkey")
  influencer   influencer? @relation(fields: [influencerId], references: [id], map: "Subscription_influencerId_fkey")
}

model supportticket {
  id           String        @id
  subject      String
  status       String
  createdAt    DateTime      @default(now())
  influencerId Int?
  brandId      String?
  chatmessage  chatmessage[]
  brand        brand?        @relation(fields: [brandId], references: [id], map: "SupportTicket_brandId_fkey")
  influencer   influencer?   @relation(fields: [influencerId], references: [id], map: "SupportTicket_influencerId_fkey")

  @@index([brandId], map: "SupportTicket_brandId_fkey")
  @@index([influencerId], map: "SupportTicket_influencerId_fkey")
}

model user {
  id             String      @id
  email          String      @unique(map: "User_email_key")
  passwordHash   String
  role           user_role
  createdAt      DateTime    @default(now())
  emailVerified  Boolean     @default(false)
  emailOtp       String?
  emailOtpExpiry DateTime?
  adminuser      adminuser?
  brand          brand?
  influencer     influencer?
}

enum user_role {
  ADMIN
  BRAND
  INFLUENCER
}

enum campaign_status {
  DRAFT
  PUBLISHED
}
