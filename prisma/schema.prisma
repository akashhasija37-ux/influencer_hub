generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

//////////////////////
// ENUMS
//////////////////////

enum UserRole {
  ADMIN
  BRAND
  INFLUENCER
}

enum CampaignStatus {
  DRAFT
  PUBLISHED
}

//////////////////////
// MODELS
//////////////////////

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  passwordHash  String
  role          UserRole
  emailVerified Boolean  @default(false)
  emailOtp       String?
  emailOtpExpiry DateTime?
  createdAt     DateTime @default(now())

  admin             AdminUser?
  brand             Brand?
  influencer        Influencer?
  
}


model AdminUser {
  id     String @id @default(cuid())
  name   String
  userId String @unique

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  chatMessages ChatMessage[]
}

model Brand {
  id            String  @id @default(cuid())
  name          String
  industry      String
  totalSpend    Float
  avatarInitial String?
  userId        String  @unique

  user           User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  campaigns      Campaign[]
  subscription   Subscription?
  supportTickets SupportTicket[]
}

model Influencer {
  id             Int     @id @default(autoincrement())
  platform       String
  username       String  @unique
  followers      Int     @default(0)
  mediaCount     Int     @default(0)
  connected      Boolean @default(false)
  engagementRate Float?
  userId         String  @unique

  user           User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  applications   Application[]
  subscription   Subscription?
  supportTickets SupportTicket[]
}

model Campaign {
  id           String         @id @default(cuid())
  title        String
  description  String
  niche        String
  budgetRange  String
  platforms    String         @db.Text
  deliverables String
  deadline     DateTime
  status       CampaignStatus
  createdAt    DateTime       @default(now())
  brandId      String

  brand        Brand         @relation(fields: [brandId], references: [id])
  applications Application[]
}

model Application {
  id           String   @id @default(cuid())
  status       String
  createdAt    DateTime @default(now())
  campaignId   String
  influencerId Int

  campaign   Campaign   @relation(fields: [campaignId], references: [id])
  influencer Influencer @relation(fields: [influencerId], references: [id])
}

model Subscription {
  id           String   @id @default(cuid())
  plan         String
  status       String
  amount       Float
  renewalDate  DateTime
  brandId      String?  @unique
  influencerId Int?     @unique

  brand      Brand?      @relation(fields: [brandId], references: [id])
  influencer Influencer? @relation(fields: [influencerId], references: [id])
}

model SupportTicket {
  id           String   @id @default(cuid())
  subject      String
  status       String
  createdAt    DateTime @default(now())
  brandId      String?
  influencerId Int?

  brand      Brand?        @relation(fields: [brandId], references: [id])
  influencer Influencer?   @relation(fields: [influencerId], references: [id])
  messages   ChatMessage[]
}

model ChatMessage {
  id        String   @id @default(cuid())
  text      String   @db.Text
  createdAt DateTime @default(now())
  ticketId  String
  senderId  String

  ticket SupportTicket @relation(fields: [ticketId], references: [id])
  sender AdminUser     @relation(fields: [senderId], references: [id])
}

model Settings {
  id                  String  @id @default(cuid())
  stripeApiKey        String?
  paypalBusinessEmail String?
  notifyOnPayment     Boolean @default(true)
  notifyOnSupport     Boolean @default(true)
  notifyOnCampaign    Boolean @default(true)
  notifyWeeklyReports Boolean @default(false)
}
