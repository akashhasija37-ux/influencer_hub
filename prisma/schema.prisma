generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

/* ================= ENUMS ================= */

enum user_role {
  ADMIN
  BRAND
  INFLUENCER
}

enum campaign_status {
  DRAFT
  PUBLISHED
}

/* ================= USER ================= */

model User {
  id             String @id @default(cuid()) @db.VarChar(191)
  email          String      @unique @db.VarChar(191)
  passwordHash   String      @db.VarChar(191)
  role           user_role
  emailVerified  Boolean     @default(false)
  emailOtp       String?     @db.VarChar(191)
  emailOtpExpiry DateTime?
  createdAt      DateTime    @default(now())

  adminUser      AdminUser?
  brand          Brand?
  influencer     Influencer?
}

/* ================= ADMIN ================= */

model AdminUser {
  id      String @id @db.VarChar(191)
  userId  String @unique @db.VarChar(191)

  user    User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

/* ================= BRAND ================= */

model Brand {
  id            String   @id @db.VarChar(191)
  userId        String   @unique @db.VarChar(191)
  name          String
  industry      String?
  totalSpend    Float    @default(0)
  avatarInitial String?
  email         String?
  phone         String?
  website       String?
  description   String?
  addressLine1  String?
  city          String?
  state         String?
  country       String?
  postalCode    String?
  instagramUrl  String?
  facebookUrl   String?
  threadsUrl    String?
  twitterUrl    String?
  linkedinUrl   String?
  youtubeUrl    String?
  logoUrl       String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user           User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  campaigns      Campaign[]
  subscription   Subscription?
  supportTickets SupportTicket[]
}

/* ================= INFLUENCER ================= */

model Influencer {
  id             Int      @id @default(autoincrement())
  userId         String   @unique @db.VarChar(191)
  platform       String
  username       String   @unique
  followers      Int      @default(0)
  mediaCount     Int      @default(0)
  engagementRate Float?
  connected      Boolean  @default(false)

  user           User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  applications   Application[]
  subscription   Subscription?
  supportTickets SupportTicket[]
}

/* ================= CAMPAIGN ================= */

model Campaign {
  id           String          @id @db.VarChar(191)
  brandId      String          @db.VarChar(191)
  title        String
  description  String
  niche        String
  budgetRange  String
  platforms    String          @db.Text
  deliverables String
  deadline     DateTime
  status       campaign_status
  createdAt    DateTime        @default(now())

  brand         Brand         @relation(fields: [brandId], references: [id], onDelete: Cascade)
  applications Application[]
}

/* ================= APPLICATION ================= */

model Application {
  id           String     @id @db.VarChar(191)
  influencerId Int
  campaignId   String     @db.VarChar(191)
  status       String
  createdAt    DateTime   @default(now())

  influencer   Influencer @relation(fields: [influencerId], references: [id], onDelete: Cascade)
  campaign     Campaign   @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@index([campaignId])
  @@index([influencerId])
}

/* ================= SUBSCRIPTION ================= */

model Subscription {
  id           String      @id @db.VarChar(191)
  plan         String
  status       String
  amount       Float
  renewalDate  DateTime

  brandId      String?     @unique @db.VarChar(191)
  influencerId Int?        @unique

  brand        Brand?      @relation(fields: [brandId], references: [id])
  influencer   Influencer? @relation(fields: [influencerId], references: [id])
}

/* ================= SUPPORT ================= */

model SupportTicket {
  id           String        @id @db.VarChar(191)
  subject      String
  status       String
  createdAt    DateTime      @default(now())

  brandId      String?       @db.VarChar(191)
  influencerId Int?

  brand        Brand?        @relation(fields: [brandId], references: [id])
  influencer   Influencer?   @relation(fields: [influencerId], references: [id])
  messages     ChatMessage[]
}

model ChatMessage {
  id        String   @id @db.VarChar(191)
  text      String   @db.Text
  senderId  String   @db.VarChar(191)
  ticketId  String   @db.VarChar(191)
  createdAt DateTime @default(now())

  ticket    SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)
}
